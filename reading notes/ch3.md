# 第3章 数据存储与检索
* 数据库核心:数据结构 
	- 哈希索引
		- key-value
	- SSTables
		- v.s. 哈希索引优点
			- 合并段更加简单高效，即使文件大于可用内存。
			- 在文件中查找特定的键时，不再需要在内存中保存所有键的索引。
			- 扫描请求范围内的 多个key value对 
				- 将记录保存到一个块中进行压缩
					- 节省磁盘空间
					- 减少I/O带宽的占用
		- 构建和维护SSTables
	- LSM-Tree
		- Lucene - 全文索引
	- 性能优化
		- Bloom filters - 查找不存在的键
		- 大小分级和分层压缩
	- B-Trees
		- 固定大小的块或页（4KB）
		- 使B-tree可靠
		- 优化B-tree
	- 对比B-tree和LSM-tree
		- B-tree
			- 优点
				- 读取更快
				- 响应延迟更有确定性
				- 每个键都恰好唯一对应于索引中的某个位置
			- 缺点
				- 索引必须至少写两次数据
		- LSM-tree
			- 优点
				- 写入更快
				- 更高的吞吐量
					- 较低的写放大
						- 顺序方式写入紧凑的STable
				- 支持更好的压缩
			- 缺点
				- 读取慢的原因
					- 不同压缩阶段检查多个不同的数据结构和SSTable
	- 其他索引结构
		- key-value
			- key对应的
			- 关系表中的一行
			- 文档数据库中的一个文档
			- 图形数据库中的一个定点
		- 在索引中存储值
			- Storing values within the index
			- 加快读取
			- 额外存储
			- 增加写入开销
		- 多列索引
			- 级联索引
			- 多维索引
		- 全文搜索和模糊索引
		- 在内存中保存所有内容
- 事务处理与分析处理
	- 事务处理系统( OLTP)/分析系统（OLAP）
		- OLTP流派
			- 日志结构流派
				- 更新的方案
				- 关键思想
					- 系统地将磁盘上随机访问写入转为顺序写入
					- 更高的写入吞吐量
				- 只允许追加是更新文件和删除过时的文件
				- 不会修改已写入的文件
			- 原地更新流派
				- 将磁盘视为可以覆盖的一组固定大小的页
				- 
	- 数据仓库（Data Warehousing）
		- 数据仓库可以针对分析访问模式进行优化
		- OLTP数据库和数据仓库之间的差异
	- 星型与雪花型分析模型
- 列式存储
	- 列压缩
		- 内存带宽和矢量化处理
	- 列存储中的排序
	- 列存储的写操作
		- 写入更加困难
	- 聚合：数据立方体与物化视图
		- Aggregation: Data Cubes and Materialized Views

| 属性         | 事务处理系统（OLTP）           | 分析系统（OLAP）             |
| :----------- | :----------------------------- | :--------------------------- |
| 主要读特征   | 基于键，每次查询返回少量的记录 | 对大量记录进行汇总           |
| 主要写特征   | 随机访问，低延迟写入用户的输入 | 批量导入或事件流             |
| 典型使用场景 | 终端用户，通过网络应用程序     | 内部分析师，为决策提供支持   |
| 数据表征     | 最新的数据状态（当前时间点）   | 随着时间而变化的所有事件历史 |
| 数据规模     | GB/TB                          | TB/PB                        |
| 瓶颈         | 磁盘寻道时间                   | 磁盘带宽 -> 面向列存储       |





![图片](https://github.com/ywjpanda/Designing-Data-intensive-Applications/blob/main/pic/ch3.jpeg?raw=true)

